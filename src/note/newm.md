## 朔閏表說明

1.  可多選曆法；1 爲公元 1 年，0 爲公元前 1 年，-1 爲公元前 2 年；若僅需計算一年，在任意一框輸入年份卽可。 一曆一年爲 1 單位，最多可展示 400 單位的朔閏表，若超過 400 會自動下載到本地。
2.  第一行爲整年的情況，例如「積2759228 天紀己卯蔀49 大51小747 冬至12.5 閏餘6842閏11」的意思是：此年上元積年爲 2759228 年，入天紀己卯蔀 49 年，天正月大餘 51、小餘 747，冬至日數 12.5，閏餘 0.6842，按照閏餘法，11 月爲閏月。大餘加上蔀或紀名干支卽爲天正朔干支，如上例，己卯 16 + 大餘 51 = 67，mod (67, 60) = 7，正月朔爲庚午。四分曆日法爲 940，小餘 747 轉換爲十進制就是 747 / 940 ≒ 0.7947。冬至 12.5 同樣需要加上蔀干支。閏餘爲十進制，若以章法19爲單位，就是0.6842×19=13。
3.  「轉」表示冬至時刻入轉<n>近點月</n>日，「交」表示冬至時刻入交泛日<n>未加日月速度改正的入交點月日數</n>，「週」表示入週天度<n>恆星年</n>。
4.  劉歆<v>世經</v>論<v>三統</v>上元積年多爲算外，但也有用算上的；<v>殷曆</v> <v>周曆</v>等古四分曆，歷代學者論上元積年多用算上，但也有用算外的。統一起見，本表各曆上元積年均爲算外，入蔀<n>統</n>年均爲算上。
5.  置閏共有三種方法：閏餘法、無中氣法、固定冬至法，閏餘法可分爲年中置閏、年末置閏兩種，無中氣法閏月必在年中<n>當然也可能在最後一個月</n> ，固定冬至法閏月必在年末。漢代以後均採用無中氣法。古六曆並不確定採用何種置閏法，本工具能同時顯示三種置閏法的結果<n>超級獨家技術</n> ，以固定冬至法爲主。第一行最後標注的是閏餘年中置閏法的閏月，若採用閏餘年末置閏法，最後一個月就是閏月。中氣一行採用無中氣置閏法，有「□□」的年份爲無中氣置閏法的閏年，「□□」表示該月無中氣，爲閏月。需要留意的是，若固定冬至法閏年在閏餘法、無中氣法的上一年，那麼該年的閏餘法、無中氣法閏月數需要加 1 ，因爲固定冬至法把該年的第一個月往上年奪去了。固定冬至法的閏月必定置於年末；無中氣法的閏月可能比閏餘年中法提前或延後一個月：中氣與朔同在一日，中氣的時刻比朔早，則閏餘未達到閏準，還不能置閏；但是由於中氣與朔已經在一日了，上個月無中氣，需要置閏。
6.  本工具的另一個獨家技術是「算三年以求一年」：秦漢以後置閏採用無中氣置閏法，如果閏月在十二或一月，在特殊情況下閏年會推後或提前一年，因此欲求一年，需同時算前後一年，以應對特殊情況。這也就意味著，如果想算 10 年的朔閏，需要算 30 年。鑒於此，我們採用滾動數組，將之前的運算結果存儲下來，以空間換時間，算 10 年朔閏只需要算 12 年，經測試，這能減少近一半的計算時間。
7.  判斷大小月的方法：看天干是否相同。如一、二、三月的朔分別是辛亥、辛巳、庚戌，辛亥、辛巳天干一樣，說明一月有 30 日，爲大月；辛巳、庚戌天干不同，說明二月有 29 日，爲小月。
8.  「平朔」卽未考慮日月速度變化而得出的朔日，「平氣」卽未考慮日速度變化而得出的中氣日，「定朔」卽加上日月速度改正而得出的朔日，「定氣」卽加上日速度改正而得出的中氣日。干支下的數字爲小分，均爲十進制小數，如「8184」卽0.8184，換算成24小時制爲：0.8184 × 24 = 19.6416，0.6416 × 60 = 38.496，0.496 × 60 ≒ 30，卽19點38分30秒。小分到取小數點後四位，卽精度爲 8.64 s。各曆均有不同的辰法，需要您手動進行轉換。未來我可能會加入辰法自動轉換。
9.  「二次」表示用二次差內插法計算出的小分，「一次」表示用線性內插法計算出的小分，「三次」表示用三次差公式計算出的小分。若某曆有二次差定朔計算，則望干支及小餘爲二次差定望，其餘曆法同理。
10.  雖然漢末<v>乾象曆</v>便出現了定朔推步，但直到唐初<v>麟德曆</v>纔正式開始用定朔編排曆書，此前都是平朔注曆，定朔僅用於交食推步。雖然隋劉焯<v>皇極曆</v> 便發明了二次差計算定朔，但編排曆書時僅採用簡單的線性內插進行計算，二次差僅用於交食推步。爲了方便，本表進朔標準是高次內插所得小分。雖然<v>皇極曆</v>開始便可以計算定氣，但直到淸<v>時憲曆</v> 纔開始用定氣編排曆書，之前都是平氣注曆。本程序在平朔注曆時代用平朔編排閏月；在定朔推曆時代用二次差編排閏月、進朔，若遇一次差與二次差存在臨界差異，用戶大可進行手動調整，但這種極端情況應該不大可能出現。
11.  <v>元嘉</v>規定若月食發生在黎明之前，則屬上日，我把此規定用於所有的魏晉系曆法。干支減去1的，在定朔干支一格加上 <span class='NewmPlus'>-</span>，小分不變。<v>麟德</v>至<v>授時</v>之前行進朔法，我目前暫時簡單將 0.75 作爲進朔標準，進朔的月在干支後加上 <span class='NewmPlus'>+</span> 來表示，僅將干支加 1，小分不變。如「乙丑+」表示原本的干支是甲子，進朔爲乙丑，而小分與進朔前一致。如果遇到與文獻不一致的情況，用戶可根據小分自行調整進朔與置閏。
12.  日食在朔，月食在望。<span class='eclipse-symbol'>● ◐ ◔</span> 分別表示全食、偏食、光影相接虧蝕微少。隋代以前的交食計算非常原始，僅能根據交食週期判斷是否可能發生日月食。<v>乾象</v>僅能計算月食所在月，<v>景初</v>能根據去交度分判斷虧蝕程度，<v>正光</v>提出食分計算方法，<v>大明</v>沒有虧食的計算，<v>大業</v>以前的魏晉南北曆法均無全食限，均無法計算日食，僅能判斷是否交會。整齊起見，我將食分、虧蝕程度一槪補全。<v>大業</v>、<v>戊寅</v>沒有計算日食持續時間的方法，我姑且用月食來補。

## 曆法更迭一覽

這一部分附上我的殘缺曆法復原思路。

### 1、

1. **三代**皆觀象授時。<u>堯</u>時一年爲 365 日。

2. **春秋晚期**產生推步曆法，此時的算法不可考。春秋時期的實行曆譜可以參考最新研究：郜積意<v>經學與曆學的貫通——春秋朔閏表與經文歷日考證</v><n><v>學術月刊</v>2020 年 1 期</n>「晉魯曆不同，非周正夏正之差。魯曆與列國曆法互異，以置閏有殊，故月每差一月；以朔法不一，故日每差一日。」

3. **戰國**

   1. 戰國早期推步曆法走向成孰，產生了<v>殷曆</v>、<v>雨水元夏曆</v><n>如果有的話</n>。楚國也許用建丑<v>殷曆</v>。
   2. 戰國中期有<v>魯曆</v>、<v>顓頊曆</v>。
   3. 戰國晚期有<v>黃帝曆</v>、<v>周曆</v>、<v>夏曆</v>。<n>古六曆合天時間見廖育棟 [古六曆的計算方法](https://ytliu0.github.io/ChineseCalendar/guliuli_chinese.html)</n>

4. **秦至漢武帝** <v>顓頊</v>。根據出土材料，可以瞭解到顓頊曆經過了多次調整，分爲如下階段<n>據朱桂昌<v>顓頊日曆表</v>，中華書局 2012，並且我自己調整了一個階段</n>。目前方案合於惠帝三年簡<n>張培瑜等<v>中國古代曆法</v>，中國科學技術出版社 2008，頁 247</n>。有一條不合：秦王政廿年前237，七月甲寅，<n>進餘 3/4</n>卻是乙卯。

   1. <n>秦獻公十九年前 366—秦武王四年前 307</n>建寅，以寅月<n>冬至所在月爲子月</n>爲正月、爲年首，與漢代以後絕大多數曆法相同。
   2. <n>秦昭王元年前 306—秦莊襄王三年前 247</n>建寅，以寅月爲正月，以十月爲年首，卽一年十二個月的順序爲 10-11<n>冬至月</n>-12-1-⋯-9。這就是標準的<v>顓頊曆</v>。
   3. <n>秦始皇元年前 246—秦二世三年前 207</n>小餘增加 3/4 日。
   4. <n>漢高帝元年前 206—呂后三年前 184</n>小餘在上一階段基礎上減去 210/940 日。<n>四分曆法一月爲 29+499/940 日，940 卽日法，見 [赫赫金鑰｜曆學二：古四分曆、三統曆](https://kqh.me/tutorial/calendar2)</n>
   5. <n>呂后四年前 183—文帝後元元年前 163</n>變閏章，之前是固定冬至置閏法的閏章，現在是無中氣置閏法的閏章，但是閏月依然放在年末，卽後九月。
   6. 在上一階段基礎上退餘 25/940 日<n>文帝後元 2 年前 162—武帝元封 7 年前 104 年 4 月</n>文帝後元二年。

5. **漢武帝至章帝** <u>鄧平</u><v>太初</v>、<v>曆術甲子篇</v><n>太初元年前 104 年 5 月—章帝元和二年 85 年正月</n>。這期間行<v>太初曆</v>，但可能也用<v>曆術甲子篇</v><n>見<v>史記</v>，爲古四分曆，我在<v>殷曆</v>基礎上減去朔餘3/4，以爲太初元年冬至朔旦夜半</n>作爲推步參考。太初改曆的內容：1、曆元從立春改爲年前朔旦冬至。2、正月爲歲首。3、行<u>鄧平</u>曆。4、歲末置閏改爲無中置閏。5、藉半日法：用途是<q>「月或朔見」</q>，其實就是承認後天半日。<n>見<v>中國古代曆法</v></n>

6. **漢章帝以後** <v>後漢四分</v><n>章帝元和二年 85 年 2 月—漢末</n>。

7. **三國兩晉**

   1. 蜀<n>221-263</n>以漢統自居，沿用<v>後漢四分</v>。
   2. <u>劉洪</u><v>乾象</v><n>吳黃武二年 223—280 吳亡</n>。<q>「二年春正月⋯⋯改四分，用乾象歷。」</q><n><v>三國志卷四七</v></n>另有魏<u>韓詡</u>造<v>黃初</v>，他批評<v>乾象</v>減斗分太過<n>回歸年太小</n>，不過實際上<q>「<u>韓翊</u>所造皆用<u>洪</u>法，小益斗下分，所錯無幾。」</q><n>我據占經復原<v>黃初</v>。
   3. <u>楊偉</u><v>景初</v><n>魏明帝景初元年 237—終晉沿用<v>景初</v>—劉宋<v>元嘉</v>行用之前</n>。另有晉武帝泰始十年<n>274</n><u>劉智</u><v>正曆</v><n>我據占經、宋志復原，月離表以<v>景初</v>補之</n>。永和八年<n>352</n><u>王朔之</u><v>通曆</v>，<v>宋志</v>：<q>「王朔之以其上元歲在甲子，善其術，欲以九萬七千歲之甲子爲開闢之始，何承天云『悼於立意者也。』」</q>這麼說積年 97000 沒問題，但算出來有問題，我就調整了積年。

8. **南朝**

   1. <u>何承天</u><v>元嘉</v><n>宋元嘉廿二年 445—509</n>。
   2. 祖沖之<v>大明</v><n>梁武帝天監九年 510—陳亡 589</n>。經過<u>祖沖之</u>之子<u>祖暅</u>力爭，得以行用。

9. **北朝**<n>參考 [廖育棟](https://ytliu0.github.io/ChineseCalendar/NorthSouth_Calendars_chinese.html)</n>

   1. **後秦** <n>384—417</n><u>姜岌</u><v>三紀甲子元</v>。我據晉志下、占經復原，月離表以<v>景初</v>補之。
   2. **北涼** <n>397—439</n><u>趙𢾺</u><v>玄始</v><n>玄始元年 412—北涼亡</n>。我據占經、<v>疇人傳</v>卷六復原。
   3. **北魏** <n>386—534</n>
      1. <v>景初</v><n>建都平城 398—451</n>。
      2. <v>玄始</v><n>文成帝興安元年 452—522</n>
      3. <u>張龍祥</u><u>李業興</u>等九家綜合而成<v>正光</v><n>孝明帝正光四年 523—558</n>。
   4. **東魏** <n>534—550</n><u>李業興</u><v>興和</v><n>興和二年 540—亡</n>。算法全襲正光，僅參數不同。
   5. **北齊** <n>550—577</n><u>宋景業</u><v>天保</v><n>天保二年 551—亡</n>，月離表據嚴敦傑<v>補北齊書曆志</v><n><v>自然科學史研究</v>1984 年第 3 期</n>補之。另有<u>董峻</u>、<u>鄭元偉</u><v>甲寅元</v>，據嚴敦傑<v>補北齊書曆志</v>補之，月離表以<v>天保</v>補之。
   6. **西魏** <n>535—557</n>沿用<v>正光</v>。
   7. **北周** <n>557—581</n>
      1. <v>明克讓</v><n>武成元年 559—565</n>。我用占經的<v>梁武大同</v>來補<v>明克讓</v>。不是很清楚這個梁武大同是什麼，可能跟明克讓沒什麼關係。<v>隋志中</v>：<q>「初，西魏入關，尚行李業興<v>正光術</v>。至武成元年，始詔克讓與麟趾學士庾季才及諸日者定新術，采<u>祖暅</u>舊議，通簡南北之術。自斯已後，頗親其謬。故周齊並時，而曆差一日。」</q><n>陳久金<v>符天曆研究</v>：<u>祖暅</u>的<v>符天經</v>與後來的<v>符天曆</v>毫無關係。</n>也就是說<v>明克讓</v>綜合南北算法，跟<v>天保</v>差了一天。我復原後運行程序，大約三年中有兩年會有一個月會差一天，很符合記載。
      2. <u>甄鸞</u><v>天和</v><n>天和元年 566—578</n>，月離表以<v>天保</v>補之。
      3. <u>馬顯</u>丙寅元<v>大象</v><n>大象元年 579—583</n>，月離表以<v>天保</v>補之。<v>通占大象曆星經</v>與大象曆配套使用，可能是張賔所作<n>許潔<v>隋唐時期的道教星象研究</v>，<v>宗教學研究</v>2009 年第 4 期，第 29 頁</n>，也許可以用來復原大象曆。<v>隋書張冑玄傳</v>：<q>「周马显造 <v>丙寅元历</v>，有阴阳转法，加减章分，进退蚀余，乃推定日，创开此数。当时术者，多不能晓。张宾因而用之，莫能考正。」</q><v>隋書</v>：<q>「小周餘、盈縮積，其曆術別推入蔀會，分用陽率 499，陰率 9。每 12 月下各有日月蝕轉分，推步加減之，乃爲定蝕大小餘，而求加時之正。」</q>

10. **隋** <n>581—618</n>

    1. <u>張賔</u><v>開皇</v><n>隋開皇四年 584—開皇十六年 596</n>，以<v>元嘉</v>、<v>大象</v>爲基礎，得以行用。月離表闕，我以<v>天保</v>補之。劉孝孫批評<v>張賔曆</v>粗疏，劉孝孫被罷。劉孝孫死後，楊素等舉薦<u>張冑玄</u>。
    2. <u>張冑玄</u><v>大業</v><n>開皇十七年 597—亡</n>。另有<v>張孟賓</v><n><u>張孟賔</u>和<u>張賔</u>是兩個人</n>、<v>甲子元劉孝孫</v>，二人同爲張子信門生。二曆以占經復原，月離、日躔以<v>皇極</v>補之，用<v>皇極</v>二次差內插算法。劉焯採<v>劉孝孫</v>，稍損益以爲<v>皇極</v>，與<v>大業</v>頗有參差，最終<v>大業</v>得以行用。這一時期的紛紜可以參考王荣彬 [隋初改历之争](https://www.mmzy.org.cn/qunyan/pmjl/201811/81247.aspx)。

11. **唐**

    1. <u>傅仁均</u><v>戊寅元</v><n>高祖武德二年 619—664</n>。<v>新唐志一</v>：<q>「仁均曆有三大、三小，云日月之蝕，必在朔望。十九年九月後，四朔頻大。」</q><u>李淳風</u>：<q>「古曆分日起於子半。⋯⋯<u>傅仁均</u>子初爲朔」</q>。另有高宗顯慶年間<n>656—661</n>印度曆法<v>九執</v>，全文見占經卷一〇四，我據顧觀光<v>九執曆解</v><n><v>武陵山人遺書</v>，<v>中國科學技術典籍通匯</v>天文部分 843 頁</n>勉強復原。我沒怎麼遵照原始的算法，只是用正弦算日月盈縮。
    2. <u>李淳風</u><v>麟德</v><n>高宗麟德二年665—728</n>。發明進朔，景龍二年 708—開元四年 716、開元九年 721—十六年 728 用進朔法推排。<n>見黃一農<v>中國史曆表朔閏訂正舉隅———以唐麟德曆行用時期爲例</v>，<v>漢學研究</v>1992年2期，頁291—296</n>
    3. <u>一行</u><v>大衍</v><n>玄宗開元十七年 729—757</n>。有所謂<q>「<v>大衍</v>寫<v>九執</v>」</q>公案。
    4. <v>至德</v><n>乾元元年 758—上元三年 762</n>。算法全襲<v>大衍</v>，節氣推後二日，我據此復原<v>至德</v>。
    5. <u>郭獻之</u><v>五紀</v><n>肅宗寶應元年 762—783</n>
    6. <v>正元</v><n>德宗興元元年 784—806</n>。<v>五紀</v>、<v>正元</v>綜合<v>大衍</v>、<v>麟德</v>，唯唯而已。憲宗即位，<u>徐昂</u>上<v>觀象曆</v>，失載。
    7. <u>徐昂</u><v>宣明</v><n>穆宗元和二年 807—892</n>。<v>宣明</v>晷漏、交會稍增損，更立新術以步五星，其餘沿襲<v>大衍</v>。
    8. <u>邊岡</u><v>崇玄</v><n>昭宗景福二年 893—950</n>。 另有術士<u>曹士蔿</u><v>符天</v><n>780-820</n>，乃民間小曆，以<q>「相減相乘法」</q>代躔離表，日法用萬分，曆元用雨水，以定氣注曆。<v>崇玄</v>本於<v>大衍</v>，而巧算源自<v>符天</v>。

12. **五代** <n>907—960</n>

    1. **梁、唐、漢**沿用<v>崇玄</v>。
    2. **晉**<u>馬重績</u><v>乙未元調元</v><n>天福五年 940—946</n><v>新五代志</v>：<q>「以宣明之氣朔合崇元之五星，二曆相參，然後符合。」</q>失傳，以我復原的<v>符天</v>代之，參數暫用<v>崇玄</v>，算法用相減相乘法。<n>算法見陳久金<v>符天曆研究</v></n>
    3. **周<n>951—960</n>**<u>王樸</u><v>欽天</v><n>後周顯德三年 956—周亡，宋初 960—963 沿用</n>沿用。躔離五星表不存，以<v>崇玄</v>補之。

13. **契丹遼** <n>907—1125</n><n>參 [廖育棟](https://ytliu0.github.io/ChineseCalendar/LiaoJinYuan_Calendars_chinese.html)</n>

    1. <u>馬重績</u><v>調元曆</v><n>應曆十一年 961 司天王白、李正等進曆—993</n>。劉義叟見到調元原文，其<v>長曆</v>可信<n>見邱靖嘉<v>遼史曆象志溯源</v>，<v>中華文史論叢</v>2012第4期</n>，那麼接下來的工作就是以我復原的核對<v>長曆</v>。

    2. <u>賈俊</u><v>大明</v><n>統和十二年994—亡</n>。失傳，以<v>宣明</v>代之。<v>遼志下</v>的這段記載比較胡扯：

       > 遼、漢、周、宋，俱行夏時，各自爲曆。國史閏朔，頗有異同。遼初用乙未元曆，本何承天元嘉曆法；後用大明曆，本祖冲之甲子元曆法。承天日食晦朏，一章必七閏；冲之日食必朔，或四年一閏。用乙未曆，漢、周多同；用大明曆，則間與宋異。國史敍事，甲子不殊，閏朔多異，以此故也。耶律儼紀以大明法追正乙未月朔，又與陳大任紀時或牴牾。

       遼金的曆法和<v>元嘉</v>、<v>祖沖之</v>風馬牛不相及。

14. **金** <n>1115—1234</n>

    1. <u>楊級</u><v>大明</v><n>天會十五年 1137—1181</n>
    2. <u>趙知微</u><v>重修大明</v><n>大定廿二年1182—亡，蒙古沿用至 1281<v>授時</v></n>

15. **宋** <n>960—1279</n>

    1. 王處訥<v>應天</v><n>964—982</n>建隆四年 963 成。宋代行用時間見<v>中國古代曆法</v>第606頁
    2. 吳昭素、徐瑩、董昭吉各上新曆，最後用<u>吳昭素</u><v>乾元</v><n>983—1000</n>。
    3. <u>史序</u><v>儀天</v><n>1001—1023</n>。
    4. <u>宋行古</u><v>崇天</v><n>1024—1064，中間用<v>明天</v>，後又用<v>崇天</v>1068—1074</n>。
    5. <v>明天</v><n>1065—1067</n>。歷史背景見董煜宇<v>从奉元历改革看北宋天文管理的绩效</v><n><v>自然科學史研究</v>2008年2期</n>
    6. <u>沈括</u>、<u>衛樸</u><v>奉元</v><n>1075—1093</n>不存，以<v>觀天</v>代之。
    7. <v>觀天</v><n>1094—1102</n>。
    8. <v>占天</v><n>1103—1105</n>，失傳。
    9. <v>紀元</v><n>1106—1127</n>。南宋定朔算法全同<v>紀元</v>，除了<v>統天</v>用歲實消長。<n>滕豔輝<v>宋代朔閏與交食研究</v>，2012 西北大學科技史博士論文，52 頁</n>
    10. 失載<n>1128—1135</n>，以<v>紀元</v>代之。
    11. <v>統元</v><n>1136—1167</n>。
    12. <v>乾道</v><n>1168—1176</n>
    13. <v>淳熙</v><n>1177—1190</n>
    14. <v>會元</v><n>1191—1198</n>
    15. <v>統天</v><n>1199—1207、1208—1251</n><v>開禧</v>期間與<v>統天</v>並推。
    16. <v>開禧</v><n>1208—1251</n>
    17. <v>淳祐</v><n>1252—1252</n>失傳，以<v>成天</v>代之。
    18. <v>會天</v><n>1253—1270</n>失傳，以<v>成天</v>代之。
    19. <v>成天</v><n>1271—1276</n>
    20. <v>本天</v><n>1277—1279</n>失傳，以<v>成天</v>代之。

16. **元** <n>1206—1370</n><u>郭守敬</u>等<v>授時</v><n>1281—1367</n>。

17. **明** <n>1368—1644</n><v>大統</v><n>1368—1662</n>。<v>大統</v>全襲<v>授時</v>，只是取消歲實消長；用 /(月實行-日平行) 取代 /(月實行)。但是據<v>大統曆書</v>，依然用的是<v>授時</v>的 /(月實行)。<n>見 廖育棟 [明朝<v>大統曆</v>的定朔計算及曆表朔日訂正](https://ytliu0.github.io/ChineseCalendar/MingCalendar_chinese.html)</n>

18. **清** <n>1644—1911</n>時憲曆

    1. <v>西洋新法曆書</v><n>1645—1679</n>
    2. <v>康熙永年曆法</v><n>1680—1726</n>
    3. <v>曆象考成</v><n>1727—1733</n>
    4. <v>曆象考成後編</v><n>1734—1913</n>

### 2、

漢代以後皆行寅正，但也有幾次改正朔事件：

1. 王莽始建國元年 9，改行建丑，將去年十二月改爲今年正月。劉玄更始元年23，復行建寅，將年末的丑月改爲十三月，也就是說公元24年正式用建寅。
2. 魏明帝景初元年 237，改行建丑，將三月改爲四月。但<q>「郊祀、迎氣，祭祠、烝嘗，巡狩、蒐田，分至啓閉，班宣時令，皆以建寅爲正。」</q>景初三年正月，明帝崩，復行建寅。<n><v>宋書志中</v></n>
3. 武周時期 689 十二月行建寅，以子月爲年首<n>如同<v>顓頊</v>建寅，以亥月爲年首</n>：正月—十二月—一月—二月⋯⋯十月。689 年只有 11 個月<n>其中一個月是閏月</n>。長安元年 701 二月復行以寅月爲年首。700 年有 15 個月<n>其中一個月是閏月</n>。
4. 肅宗 761 十二月改行建子。此年只有 10 個月。762 年四月復行建寅。此年有 14 個月，有 2 個四月<n>卯月巳月</n>和 2 個五月<n>辰月午月</n>。<n>見廖育棟 [中國歷代朔閏表](https://ytliu0.github.io/ChineseCalendar/table_chinese.html)</n>

## 曆法發展大勢

- 曆法史的第一次重大變革是戰國初期古四分曆出現，標誌著曆法從觀象授時走向推步。
- 第二次是<v>太初曆</v>，開創了諸多重要議題。
- 第三次是漢末<v>乾象</v>，歲實朔策突破四分曆框架，加上月行遲疾、月行三道，發明定朔推算的方法，用以步交食。
- 第四次是祖沖之<v>大明</v>，增歲差<n>恆星年與回歸年之差</n>，破章法<n>改變19年7閏的古閏章</n>，此後每曆都有不同的章法。
- 第五次是劉焯<v>皇極</v>，這一次稍顯複雜。後魏末年，張子信避亂海島，發現日行盈縮，門人劉孝孫、張孟賔用之於曆，推日食超於鄭元偉董峻之<v>甲寅</v>、宋景業之<v>天保</v>。次年北齊亡於北周，劉孝孫、張孟賔曆未得行用。現在見到最早的日行遲疾表是張冑玄<v>大業</v>，但是與後世日躔表完全不同，<v>大業</v>的日行遲疾只能直接加在定朔上，不能用於推算定氣。<v>皇極</v>會古通今，引入<q>「日行盈縮、交道表裏、五星遲疾」</q><n><v>疇人傳</v>序</n>，有了成孰的日躔表，可以計算定氣，發明二次差內插，此後唐宋曆法都不出<v>皇極</v>框架。唐宋一些節點性質的曆法都各有發明。如<v>麟德</v><q>「廢章蔀紀元，而用總法」</q><n><v>疇人傳</v>序</n>，閏章的槩念徹底退出曆法。<v>大衍</v>將內插法運用得爐火純青，發明不等間距二次內插，晷影差分表甚至達到五次，將月亮視差固定爲表格，發明不同緯度的晷漏求法<n><v>中國古代曆法</v>第552頁</n>。<v>崇玄</v>引入<v>符天</v>的<q>「相減相乘法」</q>，計算五星遲疾等。<v>明天</v>將所有計算全部公式化。<v>統天</v>用歲實消長、朔實消長。
- 第六次是<v>授時</v>，幾乎快到陰陽曆的終點了。<v>授時</v>全面用公式，這一點源於<v>明天</v>；各項參數都用小數點，不用傳統的分數，廢調日法，源於天竺曆法；歲實消長、取消上元積年源於<v>統天</v>——可謂集大成。
- 第七次是清代<v>時憲</v>，底層更換爲西法，用定氣注曆。

有了以上認識，我們可以將古曆分爲以下系統<n>是按照類型來分，而非行用時代</n>：

- 四分系：從古六曆到<v>後漢四分曆</v>
- 魏晉系：從<u>劉洪</u><v>乾象</v>到<u>姜岌</u><v>三紀</v>
- 北系：從<v>玄始</v>到張賔<v>開皇</v>
- 南系：從<v>元嘉</v>到初唐<v>戊寅</v>
- 隋系：<v>劉孝孫</v>、<v>張孟賔</v>、<v>皇極</v>、<v>麟德</v>
- 唐系：<v>大衍</v>到<v>欽天</v>
- 北宋系：<v>崇玄</v>到<v>觀天</v>
- 南宋系：<v>紀元</v>爲代表
- 授時系：<v>授時</v>、<v>大統</v>
- 時憲系：清代四部曆書

賛曰：<b>四分質樸，魏晉古茂，北系鈍拙，南系超捷，隋系煌煌，唐系赫赫，北宋明明，南宋唯唯，授時集大成，時憲脫胎換骨。</b>北系沒有歲差，恢復了古曆的統法蔀法，與同時期的南系相比非常落後。<v>乾象</v>創調日法<n>詳見後</n>，我稱其爲<u>古法</u>。隋至唐初是三系交錯的時候，這期間行用的四部曆法：<v>開皇</v>—<v>大業</v>—<v>戊寅</v>—<n><v>皇極</v>、</n><v>麟德</v>分別是北系<n><v>開皇</v>源自<v>大象</v></n>—南系<n><v>大業</v>師法祖沖之，又用日行遲疾</n>—南系<n><v>戊寅</v>源自<v>大業</v></n>—隋系<n><v>麟德</v>以<v>皇極</v>爲基礎</n>，最終隋系獲勝，過渡到<v>大衍</v>開創的唐系。唐系大量吸收天竺系精神，到唐末<v>崇玄</v>始用公式，直接引導了宋系的公式化進程。北宋亮點是其公式化大發展；南宋除了<v>統天</v>則幾乎一無是處，全部沿用<v>紀元</v>的算法。<u>古法</u>至於宋系而衰亂，歲實朔策大量出現小數點，積年動輒千萬年，古法實際只剩空殼，但宋人不思進取，直到<v>授時</v>纔廢除<u>古法</u>，是爲一恨；<v>明天</v>一度全面公式化，只可惜後來的宋人並不接受，依然用躔離表，是又爲一恨！<v>大衍</v>開創了高次內插的傳統，但是也告別了迭代的道路，此又是一恨。

## 幾個論題

### 置閏法

漢代以後皆用無中氣置閏法，卽沒有中氣的那個月置爲閏月。<v>太初</v>有一個特殊的置閏規則：<q>「中氣在朔若二日，則前月閏」</q>，但這條規則貫徹得並不徹底，有些前月朔，有些沒有前月朔，所以我的程序並沒有設置這條規則。<n>見斯琴畢力格等<v>太初曆特殊置閏問題</v>，<v>內師大學報</v>2007 年第 6 期，頁 748—753</n>

而先秦古六曆的置閏法並不清楚，有閏餘法、固定冬至法、無中法三種可能。他們的原理見 [大小月、無中氣置閏圖；固定冬至、無中氣置閏圖](https://kqh.me/post/midterm-leap)。

### 進朔

唐代以前都是平朔注曆，戊寅曆始用定朔注曆，但李淳風說 645 年有四月連大，<q>「庚子，詔用仁均平朔」</q>，又暫停了用定朔注曆，直到<v>麟德</v>纔固定用定朔。<n>雖然<v>皇極</v>就發明了二次內插，但唐宋時期編排曆書依然用簡單的線性內插，精確的二次差只用於交食推算。</n>用定朔注曆，就會出現四大三小現象，還有閏月不好放置的問題，所以<v>麟德</v>提出進朔法作爲解決方案，此後唐宋閒沿用進朔法，直到<v>授時</v>廢除。幾部曆法的進朔規則：

- <v>宣明</v>：秋分—春分：0.75，夏至0.74005，清明0.74924，小暑0.74031，穀雨0.74479，大暑0.74124，立夏、立秋0.74276，小滿0.74124，處暑0.74479，芒種0.74031，白露0.74924。<n><v>中國古代曆法</v>第570頁</n>
- <v>明天</v>：秋分—春分：0.75。<q>「若春分後，其定朔晨分差如春分之日者，三約之，以減四分之三；如定朔小餘及此數已上者，進一日；朔或當交有食，初虧在日入已前者，其朔不進。弦、望定小餘不滿日出分者，退一日；其望或當交有食，初虧在日出已前，其定望小餘雖滿日出分者，亦退之。又月行九道遲疾，曆有三大二小；日行盈縮累增損之，則有四大三小，理數然也。若循其常，則當察加時早晚，隨其所近而進退之，使月之大小不過連三。」</q><n><v>宋志八·明天</v>小字</n>紀元同此。
- 麟德在無中氣置閏之後說：「其元日有交、加時應見者，消息前後一兩月，以定大小，令虧在晦、二，弦、望亦隨消息。月朔盈朒之極，不過頻三。其或過者，觀定小餘近夜半者量之。」
- 新唐志五說開頭說了<v>五紀</v>進朔法

我暫時都用簡單的 0.75。

### 備忘

- 《晉書》卷一七「黃初二年六月二十九日戊辰加時未日食⋯⋯黃初以爲加辛強。」

宋志、<v>疇人傳</v><v>陳得一</v>的一段內容可以作爲兩宋之際曆法復原的參考：

> 南渡以後，星翁離散，<v>紀元術</v>亡。紹興二年，高宗重購得之。六月甲午，語輔臣曰：『術官推步不精，今術差一日，近得<v>紀元術</v>，自明年當改正。協時月正日，蓋非細事。』五年，日官言：『正月朔旦日食九分半，虧在辰正。』得一言：『當食八分半，虧在巳初。』其言卒驗。侍御史張致遠言：『今歲正月朔日食，太史所定不驗，得一嘗爲臣言，皆有依據。蓋患算造者不能通消息盈虛之奧、進退遲疾之分，致立朔有訛。凡定朔小餘七千五百以上者，進一日。紹興四年十二月小餘七千六百八十，太史不進，故十一月小盡；今年五月小餘七千一百八十，少三百二十，乃爲進朔，四月大盡。建炎三年定十一月三十日甲戌爲臘。<v>陰陽書</v>曰：<q>「臘者，接也。」</q>以故接新，在十二月近大寒前後戌日定之，若近大寒戌日在正月十一日，若即用遠大寒戌日定之，庶不出十二月。如宣和五年十一月二十七日丙午大寒，後四日庚戌，雖近，緣在六年正月一日，此時以十九日戊戌爲臘。得一於歲旦日食，嘗預言之，不差釐刻。願詔<u>得一</u>改造新秝，委官專重其事，仍盡取其書，參校太史有無，以補遺闕。擇秝算子弟粗通了者，授演撰之要，庶幾日官無曠，秝法不絕。』二月丙子，詔祕書少監朱震即祕書省監視得一改造新秝。八月秝成，震請賜名<v>統元</v>，從之。

- 1193 年 12 月紹興

> <v>宋律曆十四</v>五年，日官言，正月朔旦日食九分半，虧在辰正。常州布衣陳得一言，當食八分半，虧在巳初，其言卒驗。侍御史張致遠言：「今歲正月朔日食，太史所定不驗，得一嘗爲臣言，皆有依據。蓋患算造者不能通消息、盈虛之奧，進退、遲疾之分，致立朔有訛。凡定朔小餘七千五百以上者，進一日。紹興四年十二月小餘七千六百八十，太史不進，故十一月小盡；今年五月小餘七千一百八十，少三百二十，乃爲進朔，四月大盡。建炎三年定十一月三十日甲戌爲臘，陰陽書曰，臘者，接也，以故接新，在十二月近大寒前後戌日定之，若近大寒戌日在正月十一日，」

- <v>跋吐鲁番文书中的两件唐历</v>說麟德 678 年閏十月，但是算出來閏十一月。
- <v>寶祐四年會天曆</v>四月進朔。
- 「晨初餘數」應該是唐曆的概念，在瀚堂搜只有唐志有，其實就是日出時刻、夜半漏，只是單位換成了日法。