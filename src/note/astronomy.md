## 歲差可靠性驗證

<v>數</v>頁 188：虞𠠎<v>大同</v>公元前 2300 堯時四正昬中：冬至奎 10，春分井 31，夏至房 1，秋分女 2。頁 190：<v>大衍</v>到<v>明天</v>以前都是公元前 2300 冬至日赤在虛 1，經檢驗，我的赤度昬中算對了。

明志一：

> 堯時冬至日躔宿次，何承天推在須女十度左右，一行推在女虛間，元人曆議亦云在女虛之交。而授時曆考之，乃在牛宿二度，大統曆考之，乃在危宿一度，相差二十六度，皆不與堯合。

<v>大統</v>在前 2421 年冬至赤道在危 1.092，而<v>授時</v>在牛 3.974，似乎差了將近兩度。

> 以大統、授時二曆相較，考古則氣差三日，推今則時差九刻。
>
> 今丙申年<n>1596 年</n>日至，臣測得乙未日未正一刻，而大統推在申正二刻，相差九刻

程序大統 1596 年中冬至在乙未 6900=申正二刻，授時在 5952=未正一刻，相差九刻。

<v>皇極</v>日所在宿度直接是黃道度。「劉焯歷仁壽四年<n>605</n>冬至，日在黃道斗十度，於赤道斗十一度也。」我算出來是斗 13，奇怪。

授時曆議：

> 以金趙知微所修大明曆法推之，冬至猶躔斗初度三十六分六十四秒

程序算得<v>重修大明</v> 1281 年前冬至己未在斗 0.366<n>小數點後取三位</n>，分毫不差。

但是，

> 復以堯典中星考之，其時冬至日在女、虛之交。及考之前史，漢元和二年<n>85 年</n>，冬至日在斗二十一度；晉太元九年<n>384</n>，退在斗十七度；宋元嘉十年<n>433</n>，在斗十四度末；梁大同十年<n>544</n>，在斗十二度；隋開皇十八年<n>598</n>，猶在斗十二度；唐開元十二年<n>724</n>，在斗九度半；今退在箕十度。

| 年   | 原文   | 大衍     | 宣明     | 紀元     | 統天     | 重修大明 | 授時     | 授時無消長 |
| ---- | ------ | -------- | -------- | -------- | -------- | -------- | -------- | ---------- |
| 85   | 斗 21   | 斗 18.197 | 斗 18.319 | 斗 19.087 | 斗 19.294 | 斗 18.644 | 斗 17.147 | 斗 19.775   |
| 384  | 斗 17   | 斗 14.583 | 斗 14.795 | 斗 15.018 | 斗 15.416 | 斗 14.697 | 斗 13.857 | 斗 15.290   |
| 433  | 斗 14 末 | 斗 13.990 | 斗 14.218 | 斗 14.351 | 斗 14.763 | 斗 14.050 | 斗 13.201 | 斗 14.555   |
| 544  | 斗 12   | 斗 12.648 | 斗 12.909 | 斗 12.841 | 斗 13.264 | 斗 12.584 | 斗 11.860 | 斗 12.890   |
| 598  | 斗 12   | 斗 11.996 | 斗 12.273 | 斗 12.106 | 斗 12.525 | 斗 11.871 | 斗 11.262 | 斗 12.080   |
| 724  | 斗 9 半  | 斗 10.472 | 斗 10.788 | 斗 10.391 | 斗 10.777 | 斗 10.208 | 斗 9.635  | 斗 10.190   |
| 1280 | 箕十   | 斗 1.251  | 斗 1.735  | 斗 0.324  | 斗 0.179  | 斗 0.366  | 箕 9.850  | 箕 9.850    |

基本上對不上，奇怪。

## 歲實消長可靠性驗證

元史：<v>統天</v>「紹熙二年<n>1191</n>辛亥十一月壬申四十七刻」，藤算得 5668.8857 日分 = 0.4724，程序算得壬申 4724，相合。天正定朔藤算得 0157，程序算得 0158，相合。

藤豔輝<v>宋代朔閏</v>頁 189 有各年<v>紀元</v>、<v>統天</v>冬至時刻，算得與藤完全相同。

據刘娅娅<v>朱载堉对授时历岁余计算的检验与修正</v>：朱載堉算得隱公三年辛酉<n>前 720</n>年前冬至爲庚午 0600，次年冬至乙亥 5044，程序計算與朱載堉相合。

## 冬至可靠性驗證

這是<v>授時曆議</v>的所有數據，程序與原文不一致的列在後面。明顯是傳抄錯誤的標紅，其餘是計算不同。

| 年               | 大衍     | 原文       | 宣明     | 原文       | 紀元     | 原文       | 統天     | 原文   | 大明     | 原文       | 授時     | 原文       |
| ---------------- | -------- | ---------- | -------- | ---------- | -------- | ---------- | -------- | ------ | -------- | ---------- | -------- | ---------- |
| 獻公 15 年甲寅     |          |            |          |            |          |            |          |        |          |            |          |            |
| 僖公 5 年-655 辛亥  | 辛亥 9493 |            | 辛亥 6679 |            | 壬子 8486 | **七十四** | 辛亥 1992 | 二十七 | 壬子 8964 |            | 辛亥 1460 |            |
| 昭公 20 年-522 己丑 | 己丑 4556 |            | 己丑 2054 |            | 庚寅 2502 |            | 戊子 9535 | 九十二 | 庚寅 2945 |            | 戊子 8314 |            |
| 元嘉 12 年 435 戊辰  | 3539     |            | 3286     |            | 3959     |            | 5327     | 五十一 | 4145     |            | 4715     |            |
| 13 年 436 甲戌      | 癸酉 5984 |            | 5732     |            | 6395     |            | 7768     | 七十五 | 6581     |            | 7148     |            |
| 15 年 438 甲申      | 0872     |            | 0625     |            | 1268     |            | 2650     | 二十四 | 1453     |            | 2014     | 十九       |
| 16 年 439 己丑      | 3316     |            | 3071     |            | 3704     |            | 5091     | 四十八 | 3889     | 三十七     | 4447     |            |
| 17 年 440 甲午      | 5760     |            | 5518     |            | 6140     |            | 7532     | 七十二 | 6325     |            | 6880     |            |
| 18 年 441 己亥      | 8204     |            | 7964     |            | 8576     |            | 9973     | 九十七 | 8761     |            | 9313     |            |
| 19 年 442 乙巳      | 0648     |            | 0411     |            | 1012     |            | 2414     | 二十一 | 1197     |            | 1746     |            |
| 大明 5 年 461 乙酉   | 甲申 7085 |            | 6893     |            | 7300     |            | 8788     | 八十九 | 7480     |            | 7973     |            |
| 天嘉 6 年 565 庚寅   | 1270     |            | 1321     |            | 0667     | 五         | 2487     |        | 0818     |            | 1720     |            |
| 光大 2 年 568 乙巳   | 8602     | **八十**   | 8661     |            | 7975     |            | 9802     | 九十七 | 8126     |            | 9016     |            |
| 太建 4 年 572 丁卯   | 丙寅 8378 |            | 8446     | **七十八** | 7720     |            | 9555     |        | 7870     | **九十八** | 8744     |            |
| 6 年 574 丁丑       | 3266     |            | 3339     |            | 2593     |            | 4431     | 四十三 | 2742     |            | 3608     |            |
| 9 年 577 壬辰       | 癸巳 0599 | 四         | 0679     |            | 壬辰 9901 |            | 癸巳 1745 | 十六   | 0050     |            | 0904     | 八         |
| 10 年 578 戊戌      | 3043     |            | 3125     | 三十       | 2337     |            | 4183     | 四十   | 2486     |            | 3336     |            |
| 開皇 4 年 584 己巳   | 7707     |            | 7804     |            | 6955     |            | 8811     | 八十六 | 7101     |            | 8624     |            |
| 5 年 585 乙亥       | 0151     |            | 0250     |            | 甲戌 9391 | 九十二     | 乙亥 1249 | 十一   | 甲戌 9537 | **五十五** | 乙亥 1055 |            |
| 6 年 586 庚辰       | 2595     |            | 2696     |            | 1827     |            | 3687     | 三十四 | 1973     |            | 3486     |            |
| 7 年 587 乙酉       | 5039     |            | 5143     |            | 4263     |            | 6125     | 五十九 | 4409     |            | 5917     |            |
| 11 年 591 丙午      | 4816     |            | 4929     |            | 4008     | **四十三** | 5876     | 五十七 | 4153     |            | 5641     |            |
| 14 年 594 辛酉      | 2148     |            | 2268     |            | 1317     |            | 3189     | 三十   | 1461     |            | 2934     |            |
| 貞觀 18 年 644 乙酉  | 甲申 4352 |            | 4589     |            | 3128     |            | 5048     |        | 3258     |            | 4484     |            |
| 23 年 649 辛亥      | 庚戌 6572 |            | 6821     |            | 5309     |            | 7231     |        | 5438     |            | 6639     |            |
| 龍朔 2 年 662 戊午   | 8345     |            | 8625     |            | 6979     |            | 8904     | 八十八 | 7105     |            | 8242     |            |
| 儀鳳 1 年 676 壬申   | 2562     |            | 2875     |            | 1086     |            | 3009     | 二十八 | 1208     |            | 2276     |            |
| 永淳 1 年 682 癸卯   | 7227     |            | 7554     |            | 5704     |            | 7625     |        | 5824     |            | 7460     | **六十八** |
| 開元 10 年 722 癸酉  | 4990     |            | 5411     |            | 3152     |            | 5041     |        | 3262     |            | 4660     |            |
| 11 年 723 戊寅      | 7434     |            | 7857     | 七十七     | 5589     |            | 7476     |        | 5698     |            | 7090     |            |
| 12 年 724 癸未      | 9878     |            | 0304     |            | 8025     |            | 9911     |        | 8134     |            | 9520     |            |
| 景德 4 年 1007 戊辰  | 1553     |            | 2643     |            | 7473     |            | 8154     | 八十二 | 7507     | 七十四     | 8029     |            |
| 皇祐 2 年 1050 癸丑  | 6648     | 六十五     | 7839     | 七十九     | 2230     |            | 2580     |        | 2252     |            | 2390     |            |
| 元豐 6 年 1083 丙午  | 7303     |            | 8571     |            | 2626     |            | 2694     | 二十七 | 2639     |            | 2678     |            |
| 7 年 1084 辛亥      | 9747     |            | 壬子 1018 |            | 辛亥 5062 |            | 5121     |        | 5075     |            | 5104     |            |
| 元祐 3 年 1088 壬申  | 9523     | 九十四     | 0804     |            | 4807     |            | 4830     |        | 4818     |            | 4808     |            |
| 4 年 1089 丁丑      | 戊寅 1967 |            | 3250     |            | 丁丑 7243 |            | 7257     |        | 7254     |            | 7234     |            |
| 5 年 1090 壬午      | 癸未 4411 |            | 5696     |            | 壬午 9679 |            | 9685     | 九十七 | 9690     |            | 9660     |            |
| 7 年 1092 癸巳      | 9299     |            | 0589     |            | 4551     |            | 4539     |        | 4562     |            | 4512     |            |
| 元符 1 年 1098 甲子  | 乙丑 3964 |            | 5268     |            | 甲子 9169 |            | 9102     |        | 9178     |            | 9068     | 九十一     |
| 崇寧 3 年 1104 丙申  | 8628     |            | 9946     |            | 3786     |            | 3663     |        | 3794     |            | 3624     | 三十七     |
| 紹熙 2 年 1191 壬申  | 癸酉 1263 |            | 2786     |            | 壬申 5737 |            | 4724     |        | 5721     |            | 4775     | 四十六     |
| 慶元 3 年 1197 癸卯  | 甲辰 5928 |            | 7464     |            | 0354     |            | 癸卯 9274 |        | 甲辰 0337 |            | 癸卯 9325 | 九十二     |
| 嘉泰 3 年 1203 甲戌  | 丙子 0592 |            | 2143     |            | 乙亥 4971 |            | 3825     | 三十七 | 4952     |            | 3875     | 三十七     |
| 嘉定 5 年 1212 壬戌  | 癸亥 2589 |            | 4161     |            | 壬戌 6897 | 六十九     | 5653     |        | 6876     |            | 5700     | 五十六     |
| 紹定 3 年 1230 丙申  | 丁酉 6582 |            | 8196     | 八十三     | 0749     |            | 丙申 9313 |        | 丁酉 0723 |            | 丙申 9350 | 九十二     |
| 淳祐 10 年 1250 辛巳 | 壬午 5464 | **九十四** | 7125     |            | 辛巳 9473 | 九十六     | 7832     | 七十七 | 9442     |            | 7850     |            |
| 至元 17 年 1280 己未 | 8786     |            | 庚申 0518 |            | 己未 2560 |            | 0627     | 四     | 2520     | 二十四     | 0600     |            |

這些實例可以證明，五—九、七—九很容易相混。至於其他的差異，不知道爲什麼古人手算那麼不準。

## 躔離可靠性驗證

<v>授時曆經</v>只有晷漏立成，沒有躔離改正立成。太陽盈縮積度與<v>曆志</v>立成密合。太陰遲疾積度和立成總是差了一點點，比如 61 限，程序 4.9940，立成 4.99381075，87 限，程序 5.4283，立成 5.42827575，這點區別沒有影響。

## 步軌漏

### 會圓術

輸入圓的半徑 r、弓形的高「矢」h、週天度。

### 三斜求積術

輸入三角形三邊邊長，求面積。秦九韶三斜求積術與希倫公式等價。

### 弧矢割圓術

此處與上面授時黃赤轉換的區別是這裏可以隨意輸入黃赤交角。第一行「球面三角」是球面三角黃赤轉換的公式，第二行「三角割圓」是用三角函數代替會圓術的弧矢割圓術。弧矢割圓術在黃赤度數和黃赤交角在 45—50 度附近誤差達到最大，約 0.4 度。

### 授時大統可靠性驗證

<v>元史授時曆經</v>、朝鮮奎章閣<v>授時曆立成</v>、<v>大統通軌</v>、<v>明史曆志</v>都有晨昏立成，<v>曆經</v>、奎章閣是大都晷刻，<v>曆志</v>照錄<v>大統通軌</v>，用應天府晷刻。<v>曆經</v>自變量是黃道積度，其餘三部都是積日，要注意區分。

弧矢割圓算出來的<v>授時</v>日出與立成密合，區別在 0.0002 刻之內。自己又根據立成試出來<v>大統</v>的半弧背，跟立成密合，分毫不差，非常完美。

## 月亮位置

需要輸入此刻入降交點<n>正交</n>交點月的日數、距離冬至的日數。距離冬至日數會加上日躔、轉換爲黃道度，再進行接下來的計算。正交至半交：白大於黃，半交至正交：黃大於白。一交點月約 27.21222 日。一些觀點認爲，<v>大衍</v>月黃緯表用到了三次內插，我算得前半段`Δ = 171, -24, -8`後半段`Δ = -75, -40, 8`；曲安京否定這種說法，實質上還是二次。<v>宋曆</v>第一行赤道度以九道術求得，第二行以黃赤轉換公式求得；<v>授時</v>赤道度則直接以弧矢割圓術求得。赤白差一欄，除了紀元，都是赤道-白道，紀元較爲特殊，日月同名：`赤白差 = 黃赤差 + 黃白差`，異名：`赤白差 = 黃赤差 - 黃白差`

## 交食

### 交點月

可輸入小數或分數，算出來的小數可通過「同餘」標籤中的「連分數」化爲漸進分數。

### 可靠性驗證

<v>大業</v>、<v>戊寅</v>、<v>皇極</v>、<v>麟德</v>要根據月份來判斷，這裏爲了簡化輸入，改爲用節氣判斷季節，這不準確。入交日在正交、半交附近發生交食，交點月的一半約爲 13.6061。

所有唐宋授時曆法的交食我都按原文梳理了一遍，但問題肯定還有，只能留待以後慢慢考慮。用有實例的交食推步論文來檢驗程序：

#### 三統

漢哀帝元壽元年（前 2）正月辛丑朔日食。

> 明年正月朔日蝕，上乃徵孔光，免孫寵、息夫躬，罷侍中諸曹黃門郎數十人。宣復上書言：⋯⋯今日蝕於三始，〔如淳曰：「正月一日為歲之朝，月之朝，日之朝。始猶朝也。」〕誠可畏懼。小民正月朔日尚恐毀敗器物，何況於日虧乎！陛下深內自責，避正殿，舉直言，求過失，罷退外親及旁仄素餐之人，

#### 麟德

沒有直接例子。有一條「月在日道裏者，以所如限數減遲速定數，餘以速減遲加其定交分。而出日道表者，爲變交分。不出表者，依定交分。」不懂是做什麼的。

#### 大衍

<v>中國古代曆法</v>頁 539 有三次推算：

| 日期         | <v>中</v>食分 | 程序食分 | <v>中</v>食甚 | 程序食甚 |
| ------------ | ------------- | -------- | ------------- | -------- |
| 724 七月日食 | 9.49385       | 9.47     |               | 3218     |
| 724 七月月食 | 9.66          | 9.66     | 8235          | 8239     |
| 729 十月日食 | 15            | 15       | 3389          | 3440     |

729 年主要區別是在定朔上，<v>中</v>是 3402，程序算得 3457，程序的月亮改正大了一些。大衍曆應該沒什麼問題了。

#### 宣明

<v>中</v>頁 605 說日本保存大量<v>宣明</v>預報資料，估計是說<v>韓國科學技術史資料大系天文學編</v>第 2 冊，驪江出版社，1986。還有日本寬永二十一年<n>1665</n>宣明曆刻本。

#### 崇天

嘉祐六年，

> 司天言：六月朔，日當食六分半。（《續資治通鑒長編》卷一百九十三）

1061 年行《崇天》，結果見下表，差得有點遠，可能是「九分半強」之訛。

藤豔輝<v>崇天曆的日食推步術</v>算了天聖二年五月丁亥日食，頁 544 說入轉 22 日轉定分 1377，錯了，應該是 1317。原文是 1377，但是很明顯是原文有誤，這樣食延就有錯了。<v>宋志</v>：「天聖二年五月丁亥，算食二分半，候之不食。」1.66、1.69 按照第一種標準是一分半強，按第二種標準是一分半，原文當爲一分半。

| 日期            | 藤食分 | 程序食分 | 藤食甚 | 程序食甚      | 備註            |
| --------------- | ------ | -------- | ------ | ------------- | --------------- |
| 1024 五月丁亥   | 1.66   | 1.69     |        | 4402          |                 |
| 1026 十月癸酉   | 6.4    | 6.44     | 9:38   | 4019=9:38:44  |                 |
| 1029 八月丁亥   | 9.3    | 9.33     | 7:06   | 2958=7:05:57  |                 |
| 1040 閏正月丙辰 | 5.2    | **4.79** | 13:43  | 5721=13:43:49 |                 |
| 1042 六月壬申   | 5.1    | 5.02     | 18:27  | 7693=18:27:47 |                 |
| 1046 三月辛巳   | 7.2    | 7.27     | 13:15  | 5527=13:15:53 |                 |
| 1053 十月丙申   | 4.4    | **5.84** | 12:56  | 6386=15:19:35 | 估計是 5.4 輸錯了 |
| 1054 四月甲午   | 9.8    | **9.55** | 16:04  | 6695=16:04:04 |                 |
| 1059 閏正月丙申 | 5.2    | 5.38     | 12:50  | 5341=12:49:06 |                 |
| 1061 六月壬子   | 9.8    | 9.83     | 13:41  | 5706=13:41:39 |                 |

食甚時刻全部符合，食分有三個區別比較大，達到 0.4 分，由於文中沒有推算過程，不知道問題出在哪一步。看了下有推算過程的天聖二年五月丁亥，半晝分相符，那應該不是半晝分的問題。總之，崇天基本上沒什麼問題。

另外，藤豔輝<v>宋代朔閏</v>也有崇天紀元的計算結果，但是跟後來發的論文出入很大，估計是這篇論文的程序還有問題。

熙寧六年三月，

> 司天監言：四月朔，日當食九分。（《續資治通鑒長編》卷二百四十三）

程序算得《崇天》1073 四月甲戌朔日食分 9.05 虧 1608 甚 2540，相合。

#### 奉元

元祐六年，

> 太史奏：五月朔，日當食六分。（《續資治通鑒長編》卷四百五十七）

1091 行《奉元》，程序 v1.03 算得《奉元》五月己未分 4.01，《觀天》分 2.71，《紀元》分 3.93

#### 紀元

藤豔輝<v>紀元曆日食算法及精度分析</v>：

| 日期           | 宋史食分       | 藤食分 | 程序食分 | 宋史初虧 | 藤初虧        | 程序初虧  | 藤食甚  | 程序食甚     | 宋史復滿 | 藤復滿              | 程序復滿            |
| -------------- | -------------- | ------ | -------- | -------- | ------------- | --------- | ------- | ------------ | -------- | ------------------- | ------------------- |
| 1107 十二月壬子 |                | 8.14   | **8.53** |          |               |           | 14.0922 | 5872=14.0928 |          |                     |                     |
| 1108 五月庚戌   |                | 3.40   | 3.41     |          |               |           | 12.5541 | 5208=12.4992 |          |                     |                     |
| 1110 九月丙寅   |                | 1.62   | 1.65     |          |               |           | 16.8216 | 7021=16.8504 |          |                     |                     |
| 1112 九月乙卯   |                | 1.48   | **5.97** |          |               |           | 4.7390  | 1982=4.7568  |          |                     |                     |
| 1113 三月壬子   |                | 3.25   | 3.26     |          |               |           | 13.9006 | 5789=13.8936 |          |                     |                     |
| 1115 七月戊辰   |                | 5.44   | 5.44     |          |               |           | 11.6928 | 4867=11.6808 |          |                     |                     |
| 1118 五月壬午   |                | 2.32   | 2.30     |          |               |           | 18.4204 | 7671=18.4104 |          |                     |                     |
| 1119 四月丙子   |                | 6.34   | **7.13** |          |               |           | 18.8275 | 7838=18.8112 |          |                     |                     |
| 1120 十月戊辰   |                | 8.83   | 8.84     |          |               |           | 13.5898 | 5670=13.6080 |          |                     |                     |
| 1122 二月庚寅   |                | 7.51   | 7.49     |          |               |           | 13.6496 | 5698=13.6752 |          |                     |                     |
| 1123 八月辛巳   |                | 9.06   | 9.02     |          |               |           | 5.7544  | 2390=5.7360  |          |                     |                     |
| 1134 七月戊申   |                | 1.89   | 1.91     |          |               |           | 13.0021 | 5413=12.9912 |          |                     |                     |
| 1135 正月乙巳   | 九分半         | 9.68   | 9.68     | 辰正     | 8:19=辰正一刻 | 3471=8:19 | 10.3419 | 4310=10.344  |          |                     |                     |
| 1167 四月戊辰   | 二分           | 3.64   | 3.65     |          |               |           |         | 5796         |          |                     |                     |
| 1168 二月望     | 食既           | 15     | 15       |          |               |           |         | 7428         | 戌正三刻 | 20:40=8615=戌正三刻 | 8356=20:03=戌正初刻 |
| 1176 正月望     | 二分及三分以上 | 6.42   | 6.42     |          |               |           |         |              |          |                     |                     |

最後一條 1168 二月望，考慮了一下，感覺是史載和藤都沒加月食時差，加入時差後食甚會減少一些，復圓就提前一些。

除了三個不太相合的，<v>紀元</v>基本上沒問題。應該是特殊情況的處理沒對，留待以後考慮。

#### 其他宋曆

以下據藤豔輝<v>宋代</v>頁 185:

| 序號 | 曆法 | 日期           | 宋史食分             | 藤食分 | 程序食分 | 宋史初虧                   | 藤初虧         | 程序初虧             | 宋史食甚      | 藤食甚 | 程序食甚            | 宋史復滿          | 藤復滿 | 程序復滿      |
| ---- | ---- | -------------- | -------------------- | ------ | -------- | -------------------------- | -------------- | -------------------- | ------------- | ------ | ------------------- | ----------------- | ------ | ------------- |
| 1    | 乾道 | 1167 四月戊辰朔 | 一分                 | 2.67   | 3.51     |                            |                |                      |               |        | 5883                |                   |        |               |
| 2    | 乾道 | 1167 八月庚戌望 | 六分半               | 5.63   | 6.07     |                            |                |                      |               |        | 8968                |                   |        |               |
| 3    | 乾道 | 1168 二月望     | 食既                 | 15     | 15       |                            |                |                      |               |        |                     | 二更五點 21:39     | 21:39  | 8370          |
| 4    | 乾道 | 1173 五月朔     | 四分半 + 二分少強≒七分 | 8.62   | 7.75     | 午時五刻半-四刻半≒午初初刻 | 11:12          | 4630=午初初刻        | 未初二刻 - 三刻 | 13:21  | 5445=13:04          | 申初一刻 + 二刻已上 | 15:30  | 6259          |
| 5    | 淳熙 | 1176 九月望     | 小分百中之二十七 0.27 | 2.72*  |          | 攢點九刻                   |                |                      |               |        |                     |                   |        |               |
|      | 統元 |                | 二分及三分以上       | 1.62*  |          |                            |                |                      |               |        |                     |                   |        |               |
|      | 乾道 |                |                      | 4.01*  |          |                            |                |                      |               |        |                     |                   |        |               |
| 6    | 淳熙 | 1185 三月望     | 幾五                 | 4.92   | 4.92     |                            |                |                      | 二更二點      | 22:19  | 9341=22:25=二更四點 |                   |        |               |
| 7    | 淳熙 | 1185 九月望     | 大分五小分二十六     | 5.25   | 5.27     | 卯初三刻，系攢點九刻後     | 5:30           | 2195=5:16=卯初一刻   | 卯正三刻後    | 6:35   | 2671=6:24=卯正一刻  | 辰正初刻後        | 7:39   | 3147=辰初二刻 |
| 8    | 統天 | 1202 五月甲辰朔 |                      | 空     | 3.52     | 午初一刻-一辰有半          | 10:56          | 4453=10:41=巳正二刻  | 午正          |        |                     |                   |        |               |
| 9    | 開禧 | 1220           | 食                   | 不食   | 不食     |                            |                |                      |               |        |                     |                   |        |               |
| 10   | 統天 | 1245 七月癸巳朔 |                      | 8.40   | 3.39     |                            | 13:49          | 6022=未正一刻        |               |        |                     |                   |        |               |
|      | 開禧 |                | 八分                 | 9.35   | 8.01     | 未初三刻                   | 14:01=未正初刻 | 5810=13:56= 未初三刻 |               |        |                     |                   |        |               |

10 沒說按照哪部曆法算出來八分，如果按照我的結果，就是<v>開禧</v>，按照藤的結果，是<v>統天</v>。統天差得有點多，估計是歲實消長算法不一樣。我紀元的月食時差似乎有點問題。

#### 授時

<v>中國古代曆法</v>頁 669 有三次日食推算：

| 日期      | 元史食分 | <v>中</v>食分 | 程序大統通軌食分 | <v>中</v>食甚 | 程序食甚 | 程序授時食分 | 授時食甚 |
| --------- | -------- | ------------- | ---------------- | ------------- | -------- | ------------ | -------- |
| 1292 正月 |          | 7.168         | 9.44             | 5481.8        | 5482     | 7.77         | 5914     |
| 1299 八月 | 二分有奇 | 2.67          | 2.67             | 4390          | 4385     | 3.28         | 4856     |
| 1302 六月 | 五十七秒 | 1.15          | 0.35             | 8058          | 8061     | 0.48         | 8130     |

李勇<v>授時曆與仲康日食推算</v>列出了前 2200—前 1799 年<v>授時曆日食典</v>，<v>授時曆預報 2012 年日食</v>列出了 1990—2050 日食典。經過核對，發現連食甚時刻都差了許多，因此食分也差了 1 分左右，最大的可能是歲實消長算法不一樣。

魏文魁抨擊<v>授時</v><n><v>明志</v>一</n>：

> 宋文帝元嘉六年十一月己丑朔，日食不盡如鉤，晝星見。今以授時推之，止食六分九十六秒⋯⋯

429 年十一月己丑朔，程序算得：

- 大統通軌、大統曆志分 6.96
- 授時分 6.91 虧 3256 甚 3744

#### 大衍、大明、授時

授時曆議：

開始的兩個仲康日食、十月之交日食先不管。

春秋日食：

|                          | 大衍  | 原文 | 授時 | 原文                               |
| ------------------------ | ----- | ---- | ---- | ---------------------------------- |
| 隱公三年-719 二月己巳     | 13.10 |      | 不食 | 去交分二十六日六千六百三十一入食限 |
| 桓公三年-708 七月壬辰     | 12.91 |      | 7.12 | 食六分一十四秒                     |
| 十七年-694 十月           | 10.47 |      | 7.18 | 交分二十六日八千五百六十入食限     |
| 莊公十八年-675 三月       | 不食  |      | 8.76 |                                    |
| 二十五年-668 六月辛未     | 11.57 |      | 7.54 | 交分二十七日四百八十九入食限       |
| 二十六年-667 十二月癸亥   | 13.40 |      | 6.33 | 交分十四日三千五百五十一入食限     |
| 三十年-663 九月庚午       | 11.34 |      | 7.38 | 去交分十四日四千六百九十六入食限   |
| 僖公十二年-647 三月庚午   | 10.02 |      | 4.03 | 去交分二十六日五千一百九十二入食限 |
| 十五年-644 五月           | 不食  |      | 不食 | 去交分一日一千三百一十六入食限     |
| 文公元年-625 二月癸亥     | 10.89 |      | 7.11 | 去交分二十六日五千九百十七分入食限 |
| 十五年-611 六月辛丑       | 7.75  |      | 8.70 | 交分二十六日四千四百七十三分入食限 |
| 宣公八年-600 七月甲子     |       |      |      |                                    |
| 十年-598 四月丙辰         |       |      |      |                                    |
| 十七年-591 六月癸卯       |       |      |      |                                    |
| 成公十七年-573 十二月丁巳 |       |      |      |                                    |
| 襄公十四年-558 二月乙未   |       |      |      |                                    |
| 十五年-557 八月丁巳朔     |       |      |      |                                    |
| 二十年-552 十月丙辰       |       |      |      |                                    |
| 二十一年-551 七月庚戌     |       |      |      |                                    |
| 十月庚辰                 |       |      |      |                                    |
| 二十三年-549 二月癸酉     |       |      |      |                                    |
| 二十四年-548 七月甲子     |       |      |      |                                    |
| 八月癸巳                 |       |      |      |                                    |
| 二十七年-545 十二月乙亥   |       |      |      |                                    |
| 昭公七年-534 四月甲辰     |       |      |      |                                    |
| 十五年-526 六月丁巳       |       |      |      |                                    |
| 十七年-524 六月甲戌       |       |      |      |                                    |
| 二十一年-520 七月壬午     |       |      |      |                                    |
| 二十二年-519 十二月癸酉   |       |      |      |                                    |
| 二十四年-517 五月乙未     |       |      |      |                                    |
| 三十一年-510 十二月辛亥   |       |      |      |                                    |
| 定公五年-504 三月辛亥     |       |      |      |                                    |
| 十二年-497 十一月丙寅     |       |      |      |                                    |
| 十五年-494 八月庚辰       |       |      |      |                                    |
| 哀公十四年-480 五月庚申   |       |      |      |                                    |

三國以來日食：

|                          | 大衍 | 原文 | 大明        | 原文       | 授時        | 原文       |
| ------------------------ | ---- | ---- | ----------- | ---------- | ----------- | ---------- |
| 章武元年 221 六月戊辰      |      |      | 6426=申一刻 | 食甚未五刻 | 5959=未五刻 | 食甚未五刻 |
| 黃初三年 222 十一月庚申    |      |      | 6630=申三刻 | 食甚申三刻 | 6480=申二刻 | 食甚申二刻 |
| 中大通五年 533 四月己未    |      |      | 不食        | 虧初午四刻 | 5024=午四刻 | 虧初午四刻 |
| 太清元年 547 正月己亥      |      |      |             |            |             |            |
| 太建八年 576 六月戊申      |      |      |             |            |             |            |
| 永隆元年 680 十一月壬申    |      |      |             |            |             |            |
| 開耀元年 681 十月丙寅      |      |      |             |            |             |            |
| 嗣聖八年 691 四月壬寅      |      |      |             |            |             |            |
| 十七年 700 五月己酉        |      |      |             |            |             |            |
| 十九年 702 九月乙丑        |      |      |             |            |             |            |
| 景龍元年 707 六月丁卯      |      |      |             |            |             |            |
| 開元九年 721 辛酉九月乙巳  |      |      |             |            |             |            |
| 慶曆六年 1046 三月辛巳     |      |      |             |            |             |            |
| 皇祐元年 1049 正月甲午     |      |      |             |            |             |            |
| 五年 1053 十月丙申         |      |      |             |            |             |            |
| 至和元年 1054 四月甲午     |      |      |             |            |             |            |
| 嘉祐四年 1059 正月丙申     |      |      |             |            |             |            |
| 六年 1061 六月壬子         |      |      |             |            |             |            |
| 治平三年 1066 九月壬子     |      |      |             |            |             |            |
| 熙寧二年 1069 七月乙丑     |      |      |             |            |             |            |
| 元豐三年 1080 十一月己丑   |      |      |             |            |             |            |
| 紹聖元年 1094 三月壬申     |      |      |             |            |             |            |
| 大觀元年 1107 十一月壬子   |      |      |             |            |             |            |
| 紹興三十二年 1162 正月戊辰 |      |      |             |            |             |            |
| 淳熙十年 1183 十一月壬戌   |      |      |             |            |             |            |
| 慶元元年 1195 三月丙戌     |      |      |             |            |             |            |
| 嘉泰二年 1202 五月甲辰     |      |      |             |            |             |            |
| 嘉定九年 1216 二月甲申     |      |      |             |            |             |            |
| 淳祐三年 1243 三月丁丑     |      |      |             |            |             |            |
| 中統元年 1260 三月戊辰朔食 |      |      |             |            |             |            |
| 至元十四年 1277 十月丙辰   |      |      |             |            |             |            |

#### 大統

明志一：

> 景泰元年正月辛卯，卯正三刻月食。監官誤推辰初初刻，致失救護。

1450 年正月月食分 11.55  虧 2950=辰初初刻。

> 正德九年八月辛卯日食，曆官報食八分六十七秒⋯⋯

1514 年八月辛卯朔，分 9.01 甚 5096，差了 0.34 分。有可能是回回曆推的？

> <n>嘉靖</n>七年，欽天監奏：閏十月朔，回回曆推日食二分四十七秒，大統曆推不食。

1528 年閏十月己巳朔，分 2.03 虧 4170 甚 4525。問題可能在於我沒有判斷是否入食限，所有的都情況直接進入程序算食分。

> 萬曆十二年十一月癸酉朔，大統曆推日食九十二秒，回回曆推不食。⋯⋯邇年月食在酉而曰戌，月食將旣而曰未九分

1584 年十一月癸酉朔，分 0.93 甚 5030，程序密合。

> <n>丙申</n>閏八月朔，日食，大統推初虧巳正二刻，食幾既，而臣候初虧巳正一刻，食止七分餘。大統實後天幾二刻⋯⋯

1596 年閏八月乙丑朔，分 9.88 虧 4529=巳正三刻。食分密合，初虧晚了一刻。

> <n>萬曆</n>二十五年五月甲戌夜月食，監官推算差一日。

> <n>崇禎</n>五年九月十五日月食，監推初虧在卯初一刻，光啓等推在卯初三刻，回回科推在辰初初刻。

1632 年九月己酉望月食，程序大統分 5.01 虧 2222=卯初一刻

> <n>崇禎</n>十年正月辛丑朔日食⋯⋯大統推食一分六十三秒⋯⋯

1637 年正月辛丑朔，程序大統分 3.70。可能是「三分」之訛。

以下是 1442 年朝鮮<v>交食通軌</v>所附<v>授時曆各年交食</v>，是<v>大統通軌</v>算法的交食細草，共八次月食、一次日食，是僅存的古曆細草，我節選部分參數。以下程序與細草密合。

|          | 1430 閏十二月望               | 1431 十二月望           | 1435 四月望       | 1435 十一月日食       |
| -------- | ---------------------------- | ---------------------- | ---------------- | -------------------- |
| 盈縮曆   | 46.4964975                   |                        |                  | 342.596781           |
| 原文     |                              |                        |                  |                      |
| 盈縮差   |                              |                        |                  |                      |
| 原文     | 一度八二三六九〇             |                        |                  |                      |
| 遲疾曆   | 12.2379975                   |                        |                  | 5.813881             |
| 原文     |                              |                        |                  |                      |
| 遲疾差   |                              |                        |                  |                      |
| 原文     | 一度九六四七二八             |                        |                  |                      |
| 交泛     |                              |                        |                  | 14.554661            |
| 原文     |                              |                        |                  |                      |
| 交前後度 |                              |                        |                  |                      |
| 原文     | 一十〇度六五三一六四二九六八 |                        |                  |                      |
| 食分     | 2.76                         | 11.73                  | 8.61             | 7.52                 |
| 原文     | 二分七十五秒                 | 一十一分七十三秒一四四 | 八分六十一秒〇五 | 七分五十二秒         |
| 食甚     | 9291                         | 0263                   |                  | 5554                 |
| 原文     | 九千二百九一一九七〇五       | 二百六十三分四〇四四   |                  | 五千五百五四四六六五 |
| 初虧     | 8826                         | 9535                   |                  |                      |
| 原文     | 八千八百二六三一一四〇七     | 九千五百三五三四八三五 |                  |                      |

授時交食應該沒什麼問題了。

#### 誤差原因分析

- 躔離改正：大統通軌用立成表算，我直接用三次函數。
- 晨昏分：大統通軌用整數日入表，沒考慮冬至小分。

## 現代天文計算

### 任意時刻太陽高度、方位角、晷長

輸入年前冬至時刻<n><n>例如計算 2020 年 12 月 29 日、2021 年 6 月 29 日，均輸入 2020 年 12 月 21 日冬至時刻。可通過廖育棟網站、壽星天文曆、日梭天文曆、中國天文年曆等査詢</n></n>、該日距冬至的整數日數<n><n>冬至當日爲 0</n></n>、想要計算的時刻、地理緯度、影桿的高度<n><n>北京約 39 度</n></n>、公元年。程序自動將距冬至日數轉換爲眞黃經、赤緯。方位角正負：子線或午線以右以東爲負，以左以西爲正，本程序計算出的方位角不大於 90°
