## 具注曆說明

〔天文曆說明見「天文」模塊〕曆書按月提供全年每一日的信息，中間彩色爲天文曆部分，其餘爲具注曆部分。由於內容很多，曆書只能計算一曆一年。

## 儒略日的獲取

之前都是每部曆法分別歸算出上元的儒略日數，再將積日等同於儒略日積日，算出公曆日期。這樣很麻煩，因爲每部曆法要單獨歸算，更重要的是經常會出現一日的誤差，找不到原因。現在新方法非常妙：假設公元 1000 年年前冬至 12 月 16 日乙酉儒略日 2086292 爲曆元，算出該年假想冬至儒略日：

```javascript
const SolsJdAsm = 2086292 + ~~(365.2422 * (Y - 1000))
```

從曆元開始，冬至比理論大約差了那麼多（這步是為了校驗，不直接參與運算）：

```javascript
const SolsErr = (Solar - 365.2422) * (Y - CloseOriginAd)
```

該曆冬至干支與理論干支差了那麼多：

```javascript
let AsmRealDif = ((SolsAccum + (ScConst || 0)) - (SolsJdAsm + 50)) % 60
```

授時曆等截元曆法積日少於儒略日，會出現接近-60的數字。例如若是-59，就要變成1：

```javascript
if (abs(abs(AsmRealDif - SolsErr) - 60) > 6) {
  if (abs(AsmRealDif - SolsErr + 60) < 6) AsmRealDif += 60 // 如果是-59，就要變成1
} else {
  if (abs(AsmRealDif - SolsErr - 60) < 6) AsmRealDif -= 60  // 如果是59，就要變成-1
}
```

最後，冬至儒略日等於：

```javascript
SolsJdAsm + AsmRealDif
```

### 備忘

- 孔慶典、江曉原<v>七元甲子術研究</v>：

  > 该文内容为一个名为康遵的术士在开宝七年<n>974 年</n>为一位生于庚寅年丙戌月己巳日<n>卽 930 年 10 月 3 日</n>的人算命。注意到在文首中，庚寅年丙戌月己巳日标为「房日」

`% 60.1` 再取整是為了保留 60，如果直接 `%60`就會變成 0。

## 可靠性驗證

### 授時曆

與《授時曆故》1599年算例（《黃宗羲全集》18冊，2012，p304）相較，「推四正夜半黃道宿次」，春分密合，其餘幾個區別都很小。
