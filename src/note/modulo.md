## 同餘模塊說明

分隔符：`; , ， 。 ；空格`；組數不限

### 一次同餘式 二元一次不定方程

`ax - by = c` 等價於 `ax ≡ c (mod b)`，有解的充要條件：`(a,b)|c`，卽 c 能被 a、b 的最大公因數整除

### 最大公因數 最小公倍數

求多個整數或小數的最大公因數 gcd、最小公倍數 lcm

### 分數最小公倍數

求多組分數的最小公倍數 lcm，依次輸入各組分子、分母<n>整數分母用 1 表示。</n>

### 章蔀紀元法

依次輸入斗分、歲實分母、朔餘、日法，計算相應的章法、蔀法、紀法、元法，可以用來復原一些失傳魏晉南北曆法的參數。

## 上元積年算法

古曆入元和唐宋演紀是秦九韶<v>數書九章</v>的兩個命題。秦九韶也試圖通過大衍總數術算上元積年，但並不如意，因爲總數術缺乏對餘數的調整選擇功能。<n>曲安京<v>曆法</v>頁 29</n>

### 古曆入元

依次輸入年月參數、冬至大小餘、天正經朔大小餘，大餘卽干支序數，無須 - 1。

宋以前皆有上元積年，雖有<v>戊寅</v>、<v>統天</v>的短暫停用，但直到<v>授時</v>纔徹底廢除。根據我粗畧的觀察，漢代的上元積年是回歸年、朔望月、交食週期、五星週期的同餘數，魏晉系、北系是回歸年、朔望月的同餘數，南系是回歸年、朔望月、交食週期、近點月。

<v>後漢四分</v>的上元積年是 270 多萬年，古六曆也是差不多是這樣，所以可以判定古六曆的上元積年一定是漢代的，戰國時期的古六曆應該沒有考慮五星週期，也沒有考慮年干支，直以 1520 年爲一週期。這只是我的猜測。

### 唐宋演紀

依次輸入斗分、日法、冬至大小餘、天正經朔大小餘，大餘卽干支序數，無須 - 1。這是秦九韶紀錄的<v>開禧曆</v>演紀方法，但其他宋曆似乎並不是這樣用求一術算的，對其他曆法並不好用。

### 從零開始造唐宋曆

第一步。暴力窮舉所有符合條件的日法。

第二步。暴力窮舉所有符合條件的上元積年，從 100 萬年窮舉到 1 億年。選取一部已知曆法作爲參照，「年」輸入參照曆法化爲小數後的歲實；「月」輸入上一步生成的日法、朔餘<n><n>選擇最接近的一箇卽可</n></n>；「冬至」輸入參照曆法年前冬至的日分<n><n>如乙丑日 0.2518 分，則是 1.2518</n></n>；「天正朔」輸入參照曆法年前天正經朔的日分。按照經驗，範圍在 0.02 之內。如計算出多個上元，則縮小範圍繼續計算。如選擇了 1256 年作爲參照，計算出 73147137，則上元爲公元 1256-73147137 年。

第三步、窮舉參數。計算恆星年、近點月、交點月等參數。以比例關係求得分子整數部分，以 0.0001 遞增，窮舉得到。「參數積日」輸入參照曆法的朔閏表該年表頭相應信息。

## 備忘

- 授時曆議的後天，從成天和授時的關係來看，指的是冬至時刻。
- 關於賈俊<v>大明</v>：

> 「聖宗統和十二年，可汗州刺史賈俊進新曆，則大明曆是也。」遼大明曆術，[元](https://zh.wikipedia.org/wiki/元朝)修<v>遼史</v>時史官已不得見，因此曆象志全錄同名的南朝[宋](https://zh.wikipedia.org/wiki/刘宋)[祖沖之](https://zh.wikipedia.org/wiki/祖沖之)[大明曆](https://zh.wikipedia.org/wiki/大明曆_(祖沖之)) 術，以充篇幅，而兩者實不相干，爲後世史家所非議[[1\]](https://zh.wikipedia.org/zh-hant/大明曆_(賈俊)#cite_note-1)。但是由歷史文獻氣朔記錄推察，學者認爲遼大明曆很有可能本於唐[宣明曆](https://zh.wikipedia.org/wiki/宣明曆)。
>
> 嚴敦傑「遼曆志疑」指出：一、<v>遼史</v>曆象志朔考謂「遼己未歲<n>1079</n>氣朔與宣明曆合。」，又云日本承曆二年戊午歲<n>1078</n>與遼曆相近，而當時日本所行用就是宣明曆。二、宣明曆曾長期流行於[渤海國](https://zh.wikipedia.org/wiki/渤海國)、[女真](https://zh.wikipedia.org/wiki/女真)等北方民族，渤海國爲契丹所滅，因此宣明曆可能由此傳入契丹。三、嚴氏以[汪曰楨](https://zh.wikipedia.org/wiki/汪曰楨)<v>[歷代長術輯要](https://zh.wikipedia.org/w/index.php?title=歷代長術輯要&action=edit&redlink=1)</v>所推氣朔與遼曆不合者 12 例，改用宣明曆驗算，結果有 11 例與遼曆相符[[2\]](https://zh.wikipedia.org/zh-hant/大明曆_(賈俊)#cite_note-2)。邱靖嘉更進一步補充，宋江休復<v>江幾鄰雜志</v>云：「己亥曆日十一月大盡，契丹曆此月小，十二月十四日夜纔昏月蝕，戎使言：『竊謂爲己望』。時修<v>[唐書](https://zh.wikipedia.org/wiki/新唐書)</v>，問<n>劉</n>[羲叟](https://zh.wikipedia.org/wiki/劉羲叟)，云：『見用楚衍曆，差一日，宣明曆十一月當小盡。』」[陳漢章](https://zh.wikipedia.org/wiki/陳漢章)考證己亥爲[宋仁宗](https://zh.wikipedia.org/wiki/宋仁宗)嘉祐四年<n>1059</n>，是年十一月宋曆爲大月，遼曆爲小月，而宣明曆與遼曆同，足見遼大明曆與唐宣明曆比較接近，兩者可能存在淵源關係[[3\]](https://zh.wikipedia.org/zh-hant/大明曆_(賈俊)#cite_note-3)。
