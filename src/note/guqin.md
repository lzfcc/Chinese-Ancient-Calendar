## 琴律計算器

不好意思臨時借用一下曆法的網站，開一個琴律計算器。

`八度値 = log2(頻率比)`，`音分 = 1200 * 八度値`

三分損益律：向上是 *3/2，向下是 *2/3。A 是歸算在 1—2 個八度之間，B 是歸算在 0.5—1 個八度之間。

純律的 `+ - ` 表示多或少一個普通音差 22 音分。

## 減字譜轉唱名

我做好之後翻《陳長林琴學文集》，陳先生在1989年就做好了。（《計算機學報》1989(7)）

- s 散音，f 泛音，l 連音（上滑下滑），zhuang 撞
- 【格式】類型,徽位,弦;
- 【備註】s 不需要徽位，l 不需要弦，zhuang 不需要徽位、弦
- 【調弦法】見上「調弦法」部分
- 【律制】1 準法律，2 徽法律。明清以來一般都是準法律
- 【宮弦】以幾弦爲宮音。大多數曲子都是以三弦爲宮的正調【徵弦】一些調沒有宮音散音，就填徵弦。如果填了徵弦，會覆蓋宮弦的輸入參數
- 【宮弦頻率】現在標準是正調五弦 440hz，假設三弦爲宮，用「調弦法」算得準法律三弦是 64/81，三弦頻率就是 440 * 64/81 = 347.654321hz
- 【輸出模式】1 音名； 2 唱名；3 與宮弦的頻率比；4 頻率（以 hz 爲單位）
- 【嚴格模式】默認否，程序會自動將音準歸到標準音高，例如按音徽分大多是約值，程序將自動調整。如果輸入 1 開啟嚴格模式，輸出模式 1、2 顯示 undefined，可以將輸出模式切換到 3、4，查看頻率比。
- 【顯示結果】৹ 泛音；◠ 連音；^ 撞；· 在左表示高一個八度，· 在右表示低一個八度；<span class="upline1">上劃線</span>、<span class="upline2">上劃線</span> 高一、兩個普通音差，<span class="dnline1">下劃線</span>、<span class="dnline2">下劃線</span> 低一、兩個普通音差。普通音差＝ 大全音 ﹣ 小全音 ＝ 81/80 = 21.5 音分。

示例是査阜西《洞庭》第一、二段。第一句 9.6 徽（b4），準確約值是 9.46（3）。

<img src="https://pic.imgdb.cn/item/6172d1262ab3f51d911ef6dd.png">

<img src="https://pic.imgdb.cn/item/61791a422ab3f51d91e88438.jpg">

抓起、散音同聲暫時沒處理。

幽蘭開頭：

<img src="https://pic.imgdb.cn/item/617566142ab3f51d91453741.jpg">

`s,1;9.9,2;s,1;9.9,2;l,14;s,2;1;2;2;1;2;14,2;3;3;2;3;s,5;4;10,2;s,4;8,2;s,5;11,1;9,1;2;1;2;8,2;l,7.6;s,2;1;10,4`

第三段開頭泛音：

<img src="https://pic.imgdb.cn/item/617566142ab3f51d9145374a.jpg">

`f,10,5;6;5;6;f,11,5;6;5;6;f,13,3;f,12,5;4;5;4;5;5;f,11,6;f,12,4;5;4;3;f,10,6;f,10,7;6;5;6;5;4;f,9,6;f,10,5;4;5;6;7;6;f,12,3;f,10,6;f,11,4;f,10,5;5;4;3;4;3;4;3;4;6;5;f,11,3;f,10,3,5;f,11,4;f,10,6;f,9,4;3;4;5;4;5;f,11,4;3;f,12,5;f,11,4;3;4;3;2;3;2;1;f,9,4;3;4;5;4;5`

幽蘭以一弦爲宮，若以三弦爲宮，則會出現五度律大五度。

五度律、純律所有的音。除了 C D F G 是共用，其他加了上下線的都是純律。

| 音分                          | 唱名 | 頻率比 | 音程名 |
| ------------------------------------------------------------ | ---- | ---- | ---- |
| 0 | 1 | 1/1 |  |
| 70.67 | #<span class="dnline2">1</span> | 25/24 |  |
| 90.22 | b2 | 256/243 | 五度律小半音 |
| 92.18 | #<span class="dnline1">1</span> | 135/128 | 純律小半音 |
| 111.73 | b<span class="upline1">2</span> | 16/15 | 純律大半音 |
| 113.69 | #1 | 2187/2048 | 五度律大半音 |
| 133.24 | b<span class="upline2">2</span> | 27/25 |  |
| 180.45 | bb3 | 65536/59049 | 五度律減三度 |
| 182.40 | <span class="dnline1">2</span> | 10/9 | 純律小全音 |
| 203.91 | 2 | 9/8 | 大全音 |
| 223.46 | bb<span class="upline2">3</span> | 256/225 | 純律減三度 |
| 274.58 | #<span class="dnline2">2</span> | 75/64 | 純律增二度 |
| 294.13 | b3 | 32/27 | 五度律小三度 |
| 315.64 | b<span class="upline1">3</span> | 6/5 | 純律小三度 |
| 317.60 | #2 | 19683/16384 | 五度律增二度 |
|364.81| <span class="dnline2">3</span> | 100/81 |  |
| 384.36 | b4 | 8192/6561 | 五度律減四度 |
| 386.31 | <span class="dnline1">3</span> | 5/4 | 純律大三度 |
| 407.82 | 3 | 81/64 | 五度律大三度 |
| 427.37 | b<span class="upline2">4</span> | 32/25 | 純律減四度 |
| 476.54 | <span class="dnline1">4</span> | 320/243 | 純律窄四度 |
| 478.49 | #<span class="dnline2">3</span> | 675/512 | 純律增三度 |
| 498.04 | 4 | 4/3 | 純四度 |
| 519.55 | <span class="upline1">4</span> | 27/20 | 純律寬四度 |
| 521.51 | #3 | 177147/131072 | 五度律增三度 |
| 568.72 | #<span class="dnline2">4</span> | 25/18 |  |
| 588.27 | b5 | 1024/729 | 五度律減五度 |
| 590.22 | #<span class="dnline1">4</span> | 45/32 | 純律增四度 |
| 609.77 | b<span class="upline1">5</span> | 64/45 | 純律減五度 |
| 611.73 | #4 | 729/512 | 五度律增四度 |
| 631.28 | b<span class="upline2">5</span> | 36/25 | 純律減五度 |
| 678.49 | bb6 | 262144/177147 | 五度律減六度 |
| 680.45 | <span class="dnline1">5</span> | 40/27 | 純律窄五度 |
| 701.96 | 5 | 3/2 | 純五度 |
| 772.63 | #<span class="dnline2">5</span> | 25/16 | 純律增五度 |
| 792.18 | b6 | 128/81 | 五度律小六度 |
| 794.13 | #<span class="dnline1">5</span> | 405/256 | 純律增五度 |
| 813.69 | b<span class="upline1">6</span> | 8/5 | 純律小六度 |
| 815.64 | #5 | 6561/4096 | 五度律增五度 |
| 882.40 | bb7 | 32768/19683 | 五度律減七度 |
| 884.36 | <span class="dnline1">6</span> | 5/3 | 純律大六度 |
| 905.87 | 6 | 27/16 | 五度律大六度 |
| 925.42 | bb<span class="upline2">7</span> | 128/75 | 純律減七度 |
| 976.54 | #<span class="dnline2">6</span> | 225/128 | 純律增六度 |
| 996.09 | b7 | 16/9 | 五度律小七度 |
| 1017.59 | b<span class="upline1">7</span> | 9/5 | 純律小七度 |
| 1019.55 | #6 | 59049/32768 | 五度律增六度 |
| 1066.76 | <span class="dnline2">7</span> | 50/27 |  |
| 1086.31 | b<span class="updot1">1</span> | 4096/2187 | 五度律減八度 |
| 1088.27 | <span class="dnline1">7</span> | 15/8 | 純律大七度 |
| 1107.82 | b<span class="updot1"><span class="upline1">1</span></span> | 256/135 |  |
| 1109.78 | 7 | 243/128 | 五度律大七度 |
| 1129.33 | b<span class="updot1"><span class="upline2">1</span></span> | 48/25 | 純律減八度 |
| 1176.54 | bb<span class="updot1">2</span> | 1048576/531441 |  |

