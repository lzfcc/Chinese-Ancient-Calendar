## 琴律計算器

不好意思臨時借用一下曆法的網站，開一個琴律計算器。詳見 [赫赫金鑰｜琴律學](https://kqh.me/key/02)

## 減字譜轉唱名

我做好之後翻《陳長林琴學文集》，陳先生在1989年就做好了。（《計算機學報》1989(7)）

- 【格式】`類型,徽位,弦;`。s 散音 `s,6;`。f 泛音；長段泛音用 `[]` 包裹，如 `[7,6;9,3];` = `f,7,6;f,9,3;`。l 連音（上滑下滑）`7,7;l,7`，zh 撞，`7,7;zh;`。qi 起，`7,7;qi;` 空弦帶起；`7,7;qi,7.6;` 七徽六搯起。shang 上，xia 下 `9,1;shang`，~~fenkai 分開。suo3 璅三聲，suo7 璅七聲，suo9 璅九聲 `s,7;suo7;`dayuan 打圓。~~
- 【調弦法】見上「調弦法」部分
- 【律制】1 準法律，2 徽法律。明清以來一般都是準法律
- 【宮弦】以幾弦爲宮音。大多數曲子都是以三弦爲宮的正調【徵弦】一些調沒有宮音散音，就填徵弦。如果填了徵弦，會覆蓋宮弦的輸入參數
- 【宮弦頻率】現在標準是正調五弦 440hz，假設三弦爲宮，用「調弦法」算得準法律三弦是 64/81，三弦頻率就是 440 * 64/81 = 347.654321hz
- 【輸出模式】1 音名； 2 唱名；3 與宮弦的頻率比；4 頻率（以 hz 爲單位）
- 【嚴格模式】默認否，程序會自動將音準歸到標準音高，例如按音徽分大多是約值，程序將自動調整。如果輸入 1 開啟嚴格模式，輸出模式 1、2 顯示 undefined，可以將輸出模式切換到 3、4，查看頻率比。
- 【顯示結果】৹ 泛音；◠ 連音；^ 撞；· 在左表示高一個八度，· 在右表示低一個八度；<span class="upline1">上劃線</span>、<span class="upline2">上劃線</span> 高一、兩個普通音差，<span class="dnline1">下劃線</span>、<span class="dnline2">下劃線</span> 低一、兩個普通音差。普通音差＝ 大全音 ﹣ 小全音 ＝ 81/80 = 21.5 音分。

示例是査阜西《洞庭》第一、二段。第一句 9.6 徽（b4），準確約值是 9.46（3）。

<img src="https://pic.imgdb.cn/item/6172d1262ab3f51d911ef6dd.png">

<img src="https://pic.imgdb.cn/item/61791a422ab3f51d91e88438.jpg">

抓起、散音同聲暫時沒處理。

幽蘭開頭：

<img src="https://pic.imgdb.cn/item/617566142ab3f51d91453741.jpg">

`s,1;9.9,2;s,1;9.9,2;l,14;s,2;1;2;2;1;2;14,2;3;3;2;3;s,5;4;10,2;s,4;8,2;s,5;11,1;9,1;2;1;2;8,2;l,7.6;s,2;1;10,4`

第三段開頭泛音：

<img src="https://pic.imgdb.cn/item/617566142ab3f51d9145374a.jpg">

`[10,5;6;5;6;11,5;6;5;6;13,3;12,5;4;5;4;5;5;11,6;12,4;5;4;3;10,6;10,7;6;5;6;5;4;9,6;10,5;4;5;6;7;6;12,3;10,6;11,4;10,5;5;4;3;4;3;4;3;4;6;5;11,3;10,3,5;11,4;10,6;9,4;3;4;5;4;5;11,4;3;12,5;11,4;3;4;3;2;3;2;1;9,4;3;4;5;4;5]`

《幽蘭》以一弦爲宮。《洞庭》一三四段以四弦爲宮，第一段有 1 2 3 4 5 6，那就是徵調法或者商調法。正調四弦散音爲 G 黃鐘，那就是黃鐘爲徵調或者仲呂之徵調。不過譜子上寫的「林鐘均側弄」。

這是《古怨》，調弦法 7，律制 2，宮弦 4

`9,7;s,5;9,7;s,5;9,7;s,5;9,7;s,4;5;9,7;s,6;7;7,7;s,7;5;9,7;8,7;l,7;7,7;l,8;s,4;9,6;7;9.5,5;10,5;6;s,2;9,4;s,1;2;8.4,4;     [9,7;10,5;9,7;10,5;9,7;10,5;9,7;10,4;5;9,7;10,6;7;7;10,5;9,7;10,6;7;7;6;5;5;9,6;10,5;1;2;3;2];     s,6;1;2;3;11,1;s,3;1;2;1;3;11,1;s,3;10,1;2;1;11,2;l,10;s,4;11,2;10,3;s,5;     
10,3;4;3;4;l,8.4;s,7;9,5;8.4,4;s,7;7,5;4;5;6;5.6,2;l,7;7,6;5;6;l,6.2;s,2;6.2,6;s,3;2;6.2,6;8,7;l,7;7;l,8;7.6,6;s,5;9,7;8,7;8.4,4;9,5;l,8;s,4;9,6;5;6;7;8.4,5;10,5;9.4,4;s,2;8.4,4;s,3;11,1;s,3;11,1;s,3;11,1;s,3;11,1;l,7;[7,3;7;6;2;7]`

只有這句 `s,6;1;2;3;11,1;s,3;1;2;1;3;11,1;s,3;10,1;2;1;11,2;l,10;s,4;11,2;10,3;s,5;`  是以一弦爲宮，其他都是二弦爲宮。

這是《神奇》版《澤畔吟》，調弦法 8，律制 2，宮弦 2

`11,2;s,4;1;11,2;s,4;11,2;s,7;11,5;s,7;9,6;2;s,5;7.6,7;l,9;6;9,2;9,4;6;l,10;s,7;11,5;10,1;s,3;11,2;l,9;s,5;10,3;l,11;qi;s,7;4;9,6;5;6;5;7.6,7;7;zh;l,9;6;8.4,5;9,6;8.4,7;9,6;l,11;5;10,4;11,5;10,6;11,5;10,4;3;1;11,2;l,9;l,8;s,6;5;3;11,2;l,9;s,5;[11,2;10,4;10,1;2;5;11,2;10,7;11,5;10,7;12,6;3;10,5;7;11,3;10,4;11,2;13,6;5;10,4;5;11,2;10,6;4;12,6;10,7;12,4;10,7;4;5;7;12,4;10,7;4;5;4;7;12,4;10,7;12,2;10,5;11,2;12,6;11,3;10,7;4;12,6;5;6;5;7;5;6;4;5;10,4;6;5;11,2;12,2;10,5];8.4,7;s,5;8.4,7;l,9;9,6;11,5;5;s,7;11,5;s,7;6;9,3;yin;s,7;5;10,3;zh;l,11;s,4;11,2;12.5,1;qi;s,2;4;11,2;s,4;12.5,1;qi;s,2;1;2;4;11,2;s,4;5;9,2;7.6,6;zh;xia;8,5;7.6,4;nao;s,7;9,4;2;1;l,7.6;s,5;7;9,2;nao,l,9.5;9,1;14,1;l,10;s,3;10,3;l,11;2;s,4;9,2;8,3;7.6,4;7;yin;l,7.6;9,6;5;7.6,7;nao,qi;s,5;8.4,7;l,9;9,6;s,4;9,6;s,2;4;9,6;10,5;9,6;10,5;l,11;10,4;3;6;nao;qi;s,1;2;10,5;10,4;s,1;10,4;10,5;s,2;10,5;10,7;s,4;10,7`

